rules:
  - id: hardcoded-jwt-secret
    patterns:
      - pattern-either:
          # jsonwebtoken
          - pattern: |
              var $JWT = require("jsonwebtoken");
              ...
              var $T = $JWT.sign($P, "...", ...);
          - pattern: |
              var $JWT = require("jsonwebtoken");
              ...
              var $T = $JWT.verify($P, "...", ...);
          - pattern: |
              var $JWT = require("jsonwebtoken");
              ...
              $JWT.sign($P, "...", ...);
          - pattern: |
              var $JWT = require("jsonwebtoken");
              ...
              $JWT.verify($P, "...", ...);
          - pattern: |
              var $JWT = require("jsonwebtoken");
              ...
              var $SECRET = "...";
              ...
              var $T = $JWT.sign($P, $SECRET, ...);
          - pattern: |
              var $JWT = require("jsonwebtoken");
              ...
              var $SECRET = "...";
              ...
              var $T = $JWT.verify($P, $SECRET, ...);
          - pattern: |
              var $JWT = require("jsonwebtoken");
              ...
              var $SECRET = "...";
              ...
              $JWT.sign($P, $SECRET, ...);
          - pattern: |
              var $JWT = require("jsonwebtoken");
              ...
              var $SECRET = "...";
              ...
              $JWT.verify($P, $SECRET, ...);
          # jose
          - pattern: |
              var $JOSE = require("jose");
              ...
              var { JWT } = $JOSE;
              ...
              JWT.verify($P, "...", ...);
          - pattern: |
              var $JOSE = require("jose");
              ...
              var { JWT } = $JOSE;
              ...
              var $T = JWT.sign($P, "...", ...);
          - pattern: |
              var $JOSE = require("jose");
              ...
              var { JWT } = $JOSE;
              ...
              var $T = JWT.verify($P, "...", ...);
          - pattern: |
              var $JOSE = require("jose");
              ...
              var { JWK, JWT } = $JOSE;
              ...
              JWT.verify($P, JWK.asKey("..."), ...);
          - pattern: |
              var $JOSE = require("jose");
              ...
              var { JWK, JWT } = $JOSE;
              ...
              var $KEY = JWK.asKey("...");
              ...
              JWT.verify($P, $KEY, ...);
          - pattern: |
              var $JOSE = require("jose");
              ...
              var { JWK, JWT } = $JOSE;
              ...
              var $T = JWT.sign($P, JWK.asKey("..."), ...);
          - pattern: |
              var $JOSE = require("jose");
              ...
              var { JWK, JWT } = $JOSE;
              ...
              var $T = JWT.verify($P, JWK.asKey("..."), ...);
          - pattern: |
              var $JOSE = require("jose");
              ...
              var { JWK, JWT } = $JOSE;
              ...
              var $KEY = JWK.asKey("...");
              ...
              var $T = JWT.sign($P, $KEY, ...);
          - pattern: |
              var $JOSE = require("jose");
              ...
              var { JWK, JWT } = $JOSE;
              ...
              var $KEY = JWK.asKey("...");
              ...
              var $T = JWT.verify($P, $KEY, ...);
          - pattern: |
              var $JOSE = require("jose");
              ...
              var { JWT } = $JOSE;
              ...
              var $SECRET = "...";
              ...
              JWT.verify($P, $SECRET, ...);
          - pattern: |
              var $JOSE = require("jose");
              ...
              var { JWT } = $JOSE;
              ...
              var $SECRET = "...";
              ...
              var $T = JWT.sign($P, $SECRET, ...);
          - pattern: |
              var $JOSE = require("jose");
              ...
              var { JWT } = $JOSE;
              ...
              var $SECRET = "...";
              ...
              var $T = JWT.verify($P, $SECRET, ...);
          - pattern: |
              var $JOSE = require("jose");
              ...
              var { JWK, JWT } = $JOSE;
              ...
              var $SECRET = "...";
              ...
              JWT.verify($P, JWK.asKey($SECRET), ...);
          - pattern: |
              var $JOSE = require("jose");
              ...
              var { JWK, JWT } = $JOSE;
              ...
              var $SECRET = "...";
              ...
              var $KEY = JWK.asKey($SECRET);
              ...
              JWT.verify($P, $KEY, ...);
          - pattern: |
              var $JOSE = require("jose");
              ...
              var { JWK, JWT } = $JOSE;
              ...
              var $SECRET = "...";
              ...
              var $T = JWT.sign($P, JWK.asKey($SECRET), ...);
          - pattern: |
              var $JOSE = require("jose");
              ...
              var { JWK, JWT } = $JOSE;
              ...
              var $SECRET = "...";
              ...
              var $KEY = JWK.asKey($SECRET);
              ...
              var $T = JWT.sign($P, $KEY, ...);
          - pattern: |
              var $JOSE = require("jose");
              ...
              var { JWK, JWT } = $JOSE;
              ...
              var $SECRET = "...";
              ...
              var $T = JWT.verify($P, JWK.asKey($SECRET), ...);
          - pattern: |
              var $JOSE = require("jose");
              ...
              var { JWK, JWT } = $JOSE;
              ...
              var $SECRET = "...";
              ...
              var $KEY = JWK.asKey($SECRET);
              ...
              var $T = JWT.verify($P, $KEY, ...);
    message: |
      Hardcoded JWT secret or private key is used.
      This is a Insufficiently Protected Credentials weakness: https://cwe.mitre.org/data/definitions/522.html
      Consider using an appropriate security mechanism to protect the credentials (e.g. keeping secrets in environment variables: process.env.SECRET)
    languages: [javascript]
    severity: ERROR