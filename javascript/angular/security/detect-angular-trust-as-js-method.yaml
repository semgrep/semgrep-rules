rules:
    - id: detect-angular-trust-as-js-method
      patterns:
        - pattern-either: 
          - pattern: |
              $SOURCE = $scope.$INPUT;
              $sce.trustAsJs($SOURCE);
          - pattern: |
              $sce.trustAsJs($scope.$INPUT);
        - pattern-inside: |
            app.controller(..., function($scope,$sce){ 
            ...
            });
      message: |
        The use of $sce.trustAsJs can be dangerous if unsantiized user input flows through this API.
      severity: WARNING
      languages:
        - javascript
      metadata:
            references:
            - https://docs.angularjs.org/api/ng/service/$sce#trustAsJs
            - https://owasp.org/www-chapter-london/assets/slides/OWASPLondon20170727_AngularJS.pdf
      fix: |

