rules:
- id: crlf-injection-logs
  message: |
    When data from an untrusted source is put into a logger and not neutralized correctly,
    an attacker could forge log entries or include malicious content.
  metadata:
    cwe: "CWE-93: Improper Neutralization of CRLF Sequences ('CRLF Injection')"
    owasp: 'A1: Injection'
    source-rule-url: https://find-sec-bugs.github.io/bugs.htm#CRLF_INJECTION_LOGS
  severity: WARNING
  languages: [java]
  pattern-either:
  - pattern: |
      class $CLASS {
        ...
        Logger $LOG = ...;
        ...
        $X $METHOD(...,HttpServletRequest $REQ,...) {
          ...
          String $VAL = $REQ.getParameter(...);
          ...
          $LOG.$LEVEL(<... $VAL ...>);
          ...
        }
        ...
      }
  - pattern: |
      class $CLASS {
        ...
        Logger $LOG = ...;
        ...
        $X $METHOD(...) {
          HttpServletRequest $REQ = ...;
          ...
          String $VAL = $REQ.getParameter(...);
          ...
          $LOG.$LEVEL(<... $VAL ...>);
          ...
        }
        ...
      }
  - pattern: |
      $X $METHOD(...) {
        ...
        Logger $LOG = ...;
        ...
        HttpServletRequest $REQ = ...;
        ...
        String $VAL = $REQ.getParameter(...);
        ...
        $LOG.$LEVEL(<... $VAL ...>);
        ...
      }
  - pattern: |
      class $CLASS {
        ...
        Logger $LOG = ...;
        ...
        $X $METHOD(...,HttpServletRequest $REQ,...) {
          ...
          String $VAL = $REQ.getParameter(...);
          ...
          $LOG.log($LEVEL,<... $VAL ...>);
          ...
        }
        ...
      }
  - pattern: |
      class $CLASS {
        ...
        Logger $LOG = ...;
        ...
        $X $METHOD(...) {
          HttpServletRequest $REQ = ...;
          ...
          String $VAL = $REQ.getParameter(...);
          ...
          $LOG.log($LEVEL,<... $VAL ...>);
          ...
        }
        ...
      }
  - pattern: |
      $X $METHOD(...) {
        ...
        Logger $LOG = ...;
        ...
        HttpServletRequest $REQ = ...;
        ...
        String $VAL = $REQ.getParameter(...);
        ...
        $LOG.log($LEVEL,<... $VAL ...>);
        ...
      }
  - pattern: |
      class $CLASS {
        ...
        Logger $LOG = ...;
        ...
        $X $METHOD(...,ServletRequest $REQ,...) {
          ...
          String $VAL = $REQ.getParameter(...);
          ...
          $LOG.$LEVEL(<... $VAL ...>);
          ...
        }
        ...
      }
  - pattern: |
      class $CLASS {
        ...
        Logger $LOG = ...;
        ...
        $X $METHOD(...) {
          ServletRequest $REQ = ...;
          ...
          String $VAL = $REQ.getParameter(...);
          ...
          $LOG.$LEVEL(<... $VAL ...>);
          ...
        }
        ...
      }
  - pattern: |
      $X $METHOD(...) {
        ...
        Logger $LOG = ...;
        ...
        ServletRequest $REQ = ...;
        ...
        String $VAL = $REQ.getParameter(...);
        ...
        $LOG.$LEVEL(<... $VAL ...>);
        ...
      }
  - pattern: |
      class $CLASS {
        ...
        Logger $LOG = ...;
        ...
        $X $METHOD(...,ServletRequest $REQ,...) {
          ...
          String $VAL = $REQ.getParameter(...);
          ...
          $LOG.log($LEVEL,<... $VAL ...>);
          ...
        }
        ...
      }
  - pattern: |
      class $CLASS {
        ...
        Logger $LOG = ...;
        ...
        $X $METHOD(...) {
          ServletRequest $REQ = ...;
          ...
          String $VAL = $REQ.getParameter(...);
          ...
          $LOG.log($LEVEL,<... $VAL ...>);
          ...
        }
        ...
      }
  - pattern: |
      $X $METHOD(...) {
        ...
        Logger $LOG = ...;
        ...
        ServletRequest $REQ = ...;
        ...
        String $VAL = $REQ.getParameter(...);
        ...
        $LOG.log($LEVEL,<... $VAL ...>);
        ...
      }
  - pattern: |
      class $CLASS {
        ...
        Logger $LOG = ...;
        ...
        $X $METHOD(...,HttpServletRequest $REQ,...) {
          ...
          $LOG.$LEVEL(<... $REQ.getParameter(...) ...>);
          ...
        }
        ...
      }
  - pattern: |
      class $CLASS {
        ...
        Logger $LOG = ...;
        ...
        $X $METHOD(...) {
          HttpServletRequest $REQ = ...;
          ...
          $LOG.$LEVEL(<... $REQ.getParameter(...) ...>);
          ...
        }
        ...
      }
  - pattern: |
      $X $METHOD(...) {
        ...
        Logger $LOG = ...;
        ...
        HttpServletRequest $REQ = ...;
        ...
        $LOG.$LEVEL(<... $REQ.getParameter(...) ...>);
        ...
      }
  - pattern: |
      class $CLASS {
        ...
        Logger $LOG = ...;
        ...
        $X $METHOD(...,HttpServletRequest $REQ,...) {
          ...
          $LOG.log($LEVEL,<... $REQ.getParameter(...) ...>);
          ...
        }
        ...
      }
  - pattern: |
      class $CLASS {
        ...
        Logger $LOG = ...;
        ...
        $X $METHOD(...) {
          ...
          HttpServletRequest $REQ = ...;
          ...
          $LOG.log($LEVEL,<... $REQ.getParameter(...) ...>);
          ...
        }
        ...
      }
  - pattern: |
      $X $METHOD(...) {
        ...
        Logger $LOG = ...;
        ...
        HttpServletRequest $REQ = ...;
        ...
        $LOG.log($LEVEL,<... $REQ.getParameter(...) ...>);
        ...
      }
  - pattern: |
      class $CLASS {
        ...
        Logger $LOG = ...;
        ...
        $X $METHOD(...,ServletRequest $REQ,...) {
          ...
          $LOG.$LEVEL(<... $REQ.getParameter(...) ...>);
          ...
        }
        ...
      }
  - pattern: |
      class $CLASS {
        ...
        Logger $LOG = ...;
        ...
        $X $METHOD(...) {
          ServletRequest $REQ = ...;
          ...
          $LOG.$LEVEL(<... $REQ.getParameter(...) ...>);
          ...
        }
        ...
      }
  - pattern: |
      $X $METHOD(...) {
        ...
        Logger $LOG = ...;
        ...
        ServletRequest $REQ = ...;
        ...
        $LOG.$LEVEL(<... $REQ.getParameter(...) ...>);
        ...
      }
  - pattern: |
      class $CLASS {
        ...
        Logger $LOG = ...;
        ...
        $X $METHOD(...,ServletRequest $REQ,...) {
          ...
          $LOG.log($LEVEL,<... $REQ.getParameter(...) ...>);
          ...
        }
        ...
      }
  - pattern: |
      class $CLASS {
        ...
        Logger $LOG = ...;
        ...
        $X $METHOD(...) {
          ServletRequest $REQ = ...;
          ...
          $LOG.log($LEVEL,<... $REQ.getParameter(...) ...>);
          ...
        }
        ...
      }
  - pattern: |-
      $X $METHOD(...) {
        ...
        Logger $LOG = ...;
        ...
        ServletRequest $REQ = ...;
        ...
        $LOG.log($LEVEL,<... $REQ.getParameter(...) ...>);
        ...
      }
