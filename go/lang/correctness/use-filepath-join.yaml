rules:
  - id: use-filepath-join
    languages:
      - go
    severity: WARNING
    message: "`path.Join(...)` always joins using a forward slash. This may cause
      issues on Windows or other systems using a different delimiter. Use
      `filepath.Join(...)` instead which uses OS-specific path separators."
    patterns:
      - pattern: path.Join(...)
      - pattern-not-inside: |
          $URL, $ERR := url. ... .$ANTYHING(...)
          ...
          $URL = <... path.Join(...) ...>
      - pattern-not-inside: |
          $URL, $ERR := url. ... .$ANTYHING(...)
          ...
          path.Join(...,<... $URL ...>,...)
      - pattern-not-inside: |
          $URL, $ERR := url. ... .$ANTYHING(...)
          ...
          path.Join(...,<... $URL ...>,...)
      - pattern-not-inside: |
          path.Join(...,<... ($REQ *http.Request) ...>,...)
      - pattern-not-inside: |
          path.Join(...,<... ($RES *http.Response) ...>,...)
      - pattern-not-inside: |
          path.Join(...,<... route. ... .$ANYTHING(...) ...>,...)
      - pattern-not-inside: |
          path.Join(...,<... http. ... .$ANYTHING(...) ...>,...)
      - pattern-not-inside: |
          path.Join(...,<... http. ... .$ANYTHING ...>,...)
      - pattern-not-inside: |
          http.$ANYTHING(...,<... path.Join(...) ...>,...)
      - pattern-not-inside: |
          func ($L $ANTYHING) $R(...) *http.Request {
            ...
            path.Join(...)
          }
      - pattern-not-inside: |
          func (...) *http.Request {
            ...
            path.Join(...)
          }
      - pattern-not-inside: |
          func $SOMETHING(...) *http.Request {
            ...
            path.Join(...)
          }
      - pattern-not-inside: |
          func ($L $ANTYHING) $R(...) *url.URL {
            ...
            path.Join(...)
          }
      - pattern-not-inside: |
          func $SOMETHING(...) *url.URL {
            ...
            path.Join(...)
          }
      - pattern-not-inside: |
          func (...) *url.URL {
            ...
            path.Join(...)
          }
    metadata:
      category: correctness
      references:
        - https://parsiya.net/blog/2019-03-09-path.join-considered-harmful/
        - https://go.dev/src/path/path.go?s=4034:4066#L145
      technology:
        - go
      likelihood: LOW
      impact: HIGH
      confidence: LOW
      subcategory:
        - audit
      license: Commons Clause License Condition v1.0[LGPL-2.1-only]

