rules:
- id: tainted-url-host
  languages:
  - go
  message: >-
    User data flows into the host portion of this manually-constructed URL.
    This could allow an attacker to send data to their own server, potentially exposing
    sensitive data such as cookies or authorization information sent with this request.
    They could also probe internal servers or other resources that the server runnig
    this code can access. (This is called server-side request forgery, or SSRF.) Do
    not allow arbitrary hosts. Instead, create an allowlist for approved hosts hardcode
    the correct host.
  mode: taint
  pattern-sinks:
  - patterns:
    - pattern-either:
      - pattern: fmt.Fprintf($F, "$URLSTR", ...)
      - pattern: fmt.Sprintf("$URLSTR", ...)
      - pattern: fmt.Printf("$URLSTR", ...)
      - pattern: '"$URLSTR" + ...'
    - metavariable-regex:
        metavariable: $URLSTR
        regex: http(s?)://%(v|s|q).*
  pattern-sources:
  - pattern-either:
    - pattern: '($REQUEST : *http.Request).$ANYTHING'
    - pattern: '($REQUEST : http.Request).$ANYTHING'
  severity: WARNING
