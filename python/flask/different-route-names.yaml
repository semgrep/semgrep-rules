rules:
  - id: flask-view-func-match-route-params
    patterns:
      - pattern-either:
          - pattern: |
              @app.route($PATH, ...)
              def $R($A):
                  ...
          - pattern: |
              @app.route($PATH, ...)
              def $R($A, $AA):
                  ...
          - pattern: |
              @app.route($PATH, ...)
              def $R($A, $AA, $AAA):
                  ...
          - pattern: |
              @app.route($PATH, ...)
              def $R($A, $AA, $AAA, $AAAA):
                  ...
          - pattern: |
              @app.route($PATH, ...)
              def $R($A, $AA, $AAA, $AAAA):
                  ...
          - pattern: |
              @app.route($PATH, ...)
              def $R($A, $AA, $AAA, $AAAA, $AAAAA):
                  ...
      - pattern-where-python: |
          set(
              [
                  part.lstrip("<").rstrip(">")
                  for part in vars["$PATH"].replace('"', "").split("/")
                  if part.startswith("<") and part.endswith(">")
              ]
          ) != set([v for k, v in vars.items() if k.startswith("$A")])
    message: The view function arguments to `$R` don't match the path defined in @app.route($PATH)
    languages: [python]
    severity: WARNING
