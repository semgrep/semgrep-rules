rules:
  - id: open-never-closed
    patterns:
        - pattern-not-inside: |
            $F = open(...)
            ...
            $F.close()
        - pattern-not-inside: |
            $F = io.open(...)
            ...
            $F.close()
        - pattern-not-inside: |
            $F = os.open(...)
            ...
            $F.close()
        - pattern-not-inside: |
            $F = tarfile.open(...)
            ...
            $F.close()
        - pattern-not-inside: |
            $F = ZipFile.open(...)
            ...
            $F.close()
        - pattern-not-inside: |
            $F = tempfile.TemporaryFile(...)
            ...
            $F.close()
        - pattern-not-inside: |
            $F = tempfile.NamedTemporaryFile(...)
            ...
            $F.close()
        - pattern-not-inside: |
            $F = tempfile.SpooledTemporaryFile(...)
            ...
            $F.close()
        - pattern-either:
            - pattern: $F = open(...)
            - pattern: $F = io.open(...)
            - pattern: $F = os.open(...)
            - pattern: $F = tarfile.open(...)
            - pattern: $F = ZipFile.open(...)
            - pattern: $F = tempfile.TemporaryFile(...)
            - pattern: $F = tempfile.NamedTemporaryFile(...)
            - pattern: $F = tempfile.SpooledTemporaryFile(...)
    message: "file object opened without corresponding close"
    languages: [python]
    severity: ERROR
