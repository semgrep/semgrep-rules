rules:
  - id: hardcoded-token
    message: >-
      Hardcoded AWS access token detected. Attackers can possibly freely read this value
      and gain access to the AWS environment. Instead, use environment variables to
      access tokens (e.g., os.environ.get(...)) or use non version-controlled configuration
      files.
    metadata:
      cwe: "CWE-798: Use of Hard-coded Credentials"
      owasp: "A2: Broken Authentication"
      source-rule-url: https://pypi.org/project/flake8-boto3/
      references:
        - https://bento.dev/checks/boto3/hardcoded-access-token/
        - https://aws.amazon.com/blogs/security/what-to-do-if-you-inadvertently-expose-an-aws-access-key/
      category: security
      technology:
        - boto3
    languages: [python]
    severity: WARNING
    patterns:
    - pattern-either:
      - patterns:
        - pattern: $W(..., aws_access_key_id="$KEY", ...)
        - metavariable-regex:
            metavariable: $KEY
            regex: ^A(K|S)I.*  
        - metavariable-analysis:
            metavariable: $KEY
            analyzer: entropy
      - patterns:  
        - pattern-either:
          - pattern: $W(..., aws_secret_access_key="$SECRET", ...)
          - pattern: $W(..., aws_session_token="$SECRET", ...)
        - metavariable-analysis:
            metavariable: $SECRET
            analyzer: entropy
