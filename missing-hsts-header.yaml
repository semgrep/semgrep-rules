rules:
- id: missing-hsts-header
  pattern-either:
  - patterns:
    - pattern-inside: "public void Configure(...) {\n    ...\n}\n"
    - pattern: (IApplicationBuilder $APP)
    - pattern-not-inside: "public void Configure(...) {\n    ...\n    (IApplicationBuilder\
        \ $APP).UseHsts(...);\n    ...\n}\n"
  - patterns:
    - pattern-inside: "public void ConfigureServices(...) {\n    ...\n}\n"
    - pattern: (IServiceCollection $SERVICES)
    - pattern-not-inside: "public void ConfigureServices(...) {\n    ...\n    (IServiceCollection\
        \ $SERVICES).AddHsts(...);\n    ...\n}\n"
  message: The HSTS HTTP response security header is missing, allowing interaction
    and communication to be sent over the insecure HTTP protocol.
  metadata:
    category: security
    technology:
    - dotnet
    owasp:
    - "A02:2021 \u2013 Cryptographic Failures"
    cwe: 'CWE-346: Origin Validation Error'
    references:
    - https://cwe.mitre.org/data/definitions/346.html
    - https://owasp.org/Top10/A02_2021-Cryptographic_Failures/
  languages:
  - csharp
  severity: WARNING
